<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Understanding A Python 3 8 Quine | Dave Bartram Blog</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Understanding A Python 3 8 Quine" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Lessons I’m learning as a: Software platform engineer, Tabletop roleplayer, Lifelong lover of maths &amp; science" />
<meta property="og:description" content="Lessons I’m learning as a: Software platform engineer, Tabletop roleplayer, Lifelong lover of maths &amp; science" />
<link rel="canonical" href="http://localhost:4000/blog/2021/09-02-Understanding-a-Python-38-Quine/post.txt" />
<meta property="og:url" content="http://localhost:4000/blog/2021/09-02-Understanding-a-Python-38-Quine/post.txt" />
<meta property="og:site_name" content="Dave Bartram Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-09-02T14:45:39+01:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Understanding A Python 3 8 Quine" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2021-09-02T14:45:39+01:00","datePublished":"2021-09-02T14:45:39+01:00","description":"Lessons I’m learning as a: Software platform engineer, Tabletop roleplayer, Lifelong lover of maths &amp; science","headline":"Understanding A Python 3 8 Quine","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/blog/2021/09-02-Understanding-a-Python-38-Quine/post.txt"},"url":"http://localhost:4000/blog/2021/09-02-Understanding-a-Python-38-Quine/post.txt"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Dave Bartram Blog" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Dave Bartram Blog</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a><a class="page-link" href="/blog/2021/08-20-Vancian-Spellcasting-in-Tabletop-RPGs/post.txt">Vancian Spellcasting In Tabletop Rpgs</a><a class="page-link" href="/blog/2021/01-04-ReInvent-2020-1--AWS-Systems-Manager/post.txt">Reinvent 2020 Part 1 Aws Systems Manager</a><a class="page-link" href="/blog/2021/06-03-Reflections-on-the-AWS-Solutions-Architect-Associate-certification-(2021)/post.txt">Reflections On The Aws Solutions Architect Associate Certification 2021</a><a class="page-link" href="/blog/2021/03-22-RPG-Review-Worlds-Without-Number/post.txt">Rpg Review Worlds Without Number</a><a class="page-link" href="/blog/2021/08-12-AWS-Cloudformation-Example-Part-2--Deploy-and-Test-a-REST-API-+-Lambda-Function/post.txt">Aws Cloudformation Example Part 2 Deploy And Test A Rest Api Lambda Function</a><a class="page-link" href="/blog/2021/01-08-Advent-of-Code-2020-Days-1-5/post.txt">Advent Of Code 2020 Days 1-5</a><a class="page-link" href="/blog/2021/07-08-Doubting-Tau--a-question-of-%CF%80/post.txt">Doubting Tau A Question Of %Cf%80</a><a class="page-link" href="/blog/2021/04-29-Configuring-the-nginx-proxy-in-an-Elastic-Beanstalk-Linux-environment/post.txt">Configuring The Nginx Proxy In An Elastic Beanstalk Linux Environment</a><a class="page-link" href="/blog/2021/01-12-ReInvent-2020-2-%E2%80%93-Amazon-CodeGuru/post.txt">Reinvent 2020 2 Amazon Codeguru</a><a class="page-link" href="/blog/2021/08-02-AWS-Cloudformation-Example-Part-1--SAM-Template-for-REST-API-+-Lambda-Function/post.txt">Aws Cloudformation Example Part 1 Sam Template For Rest Api Lambda Function</a><a class="page-link" href="/blog/2021/01-22-ReInvent-2020-3-%E2%80%93-Container-Insights/post.txt">Reinvent 2020 3 Container Insights</a><a class="page-link" href="/blog/2021/09-02-Understanding-a-Python-38-Quine/post.txt">Understanding A Python 3 8 Quine</a><a class="page-link" href="/blog/2021/02-02-Advent-of-Code-2020-Days-11-15/post.txt">Advent Of Code 2020 Days 11-15</a><a class="page-link" href="/blog/2021/10-05-SQL-Server-Queries--Task-Duration-and-Inserting-Defaults/post.txt">Sql Server Queries Task Duration Inserting Defaults</a><a class="page-link" href="/blog/2021/10-26-RPG-Review-Stars-Without-Number-Revised-Edition/post.txt">Rpg Review Stars Without Number Revised Edition</a><a class="page-link" href="/blog/2021/02-22-Adding-Date-Related-Features-to-a-Pandas-Dataframe/post.txt">Adding Date Related Features To A Pandas Dataframe</a><a class="page-link" href="/blog/2021/03-08-Advent-of-Code-2020-Days-16-20/post.txt">Advent Of Code 2020 Days 16-20</a><a class="page-link" href="/blog/2021/12-17-Advent-of-Code-2021-Days-1-5/post.txt">Advent Of Code 2021 Days 1-5</a><a class="page-link" href="/blog/2021/07-15-Python-API-Request-with-Error-Handling-England-and-Wales-Bank-Holidays/post.txt">Python Api Request With Error Handling England Wales Bank Holidays</a><a class="page-link" href="/blog/2021/04-13-How-to-solve-SSL-Error-unable-to-get-local-issuer-certificate-for-Python-on-Windows/post.txt">How To Solve Ssl Error Unable To Get Local Issuer Certificate For Python On Windows</a><a class="page-link" href="/blog/2021/04-06-Advent-of-Code-2020-Days-21-25/post.txt">Advent Of Code 2020 Days 21-25</a><a class="page-link" href="/blog/2021/01-14-Advent-of-Code-2020-Days-6-10/post.txt">Advent Of Code 2020 Days 6-10</a><a class="page-link" href="/blog/2022/01-05-Advent-of-Code-2021-Days-6-10/post.txt">Advent Of Code 2021 Days 6-10</a><a class="page-link" href="/blog/2022/03-01-Advent-of-Code-2021-Days-11-15/post.txt">Advent Of Code 2021 Days 11-15</a><a class="page-link" href="/blog/2022/03-21-Advent-of-Code-2021-Days-16-20/post.txt">Advent Of Code 2021 Days 16-20</a><a class="page-link" href="/blog/2022/04-17-Advent-of-Code-2021--Days-21-25/post.txt">Advent Of Code 2021 Days 21-25</a><a class="page-link" href="/blog/2020/12-23-Bash-Scripting-2--Command-Substitution/post.txt">Bash Scripting 2 Command Substitution</a><a class="page-link" href="/blog/2020/12-18-The-Wizard-is-on-Mute-Roleplaying-During-the-Pandemic/post.txt">Roleplaying During The Pandemic</a><a class="page-link" href="/blog/2020/11-13-Bash-Scripting-1--the-whole-shebang/post.txt">Bash Scripting 1 The Whole Shebang</a><a class="page-link" href="/blog/2020/11-17-Great-content-from-Stand-up-Maths-Benfords-Law-Dodgy-Scatter-Graphs-and-the-2020-US-Election/post.txt">Great Content From Stand Up Maths Benfords Law Dodgy Scatter Graphs And The 2020 Us Election</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Understanding A Python 3 8 Quine</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2021-09-02T14:45:39+01:00" itemprop="datePublished">Sep 2, 2021
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    # Understanding a Python 3.8 Quine

![a primate examines themselves in the mirror](/images/pexels-photo-1207875.jpeg)

What is a quine?
----------------

Per the font of all human knowledge, Wikipedia, "a quine is a computer program which takes no input and produces a copy of its own source code as its only output".

Quines are named after the logician Willard Quine, and are quite interesting from a theoretical point of view and fun to think about. I thought I'd pick a Python quine and analyse how it works, and what syntactical tricks it exploits to replicate itself in the output.

Python 3.8 quine (from Stackoverflow)
-------------------------------------

Rather arbitrarily, I've picked this quine (tested in Python 3.8) from [StackOverflow](https://stackoverflow.com/questions/6223285/shortest-python-quine), in the response by user [hallo](https://stackoverflow.com/users/4698348/hallo).

```python
print((lambda x:f"{x}{x,})")('print((lambda x:f"{x}{x,})")',))
```

I just thought the syntax of it looked fun, and I wanted to understand it and hopefully share that understanding with you.

Note that Python 3.8 will usually interpret a value followed by a comma `x,` as a one-element tuple whose string representation is `(x,)`. This will be important later for keeping track of brackets!

Ingredients of the quine
------------------------

### The print statement

This line of code has only one print statement, on the outside. The second time the word print appears, it is inside a string and won't actually cause anything to be printed.

The print statement on the outside does what you'd expect, so there's not much to say about this ingredient.

### f-strings in Python

A more significant element in this quine is the use of f-strings. New in Python 3, f-strings are "formatted string literals", they allow you to insert variables or other Python expressions into a string.

To do this you simply prefix the string with an `f` or `F` before the opening single or triple quote, and contain the Python expression you want to insert in braces `{}`.

Example:
```python
name = 'Boba Fett'
age = 19
pronoun = 'he'
max_value = 10

message = f'When {name} was {age} years old, {pronoun} learned to count to {max_value}: {list(range(1,max_value+1))}'

print(message)
```
Output:
```
When Boba Fett was 19 years old, he learned to count to 10: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
```

### Lambda functions in Python

This quine uses lambda notation to define a function. This is a useful notation to define a function in a single line by specifying the output that results from a given input.

Let's look at an example:

```python
func = lambda x:x*5
```

Here we have defined a function `func` which takes an input `x` and returns an output `x*5`.

Having defined `func` , we can apply it to a few different inputs:

```python
print(func(3))
print(func('jiminy'))
print(func(300.5))
```

which will yield, predictably:

```
15
jiminyjiminyjiminyjiminyjiminy
1502.5
```

### The function `lambda x:f"{x}{x,})"`

The workhorse of this quine is the function `lambda` `x:f"{x}{x,})"`

Let's try and break it down - this takes an input `x` and returns an output `f"{x}{x,})"`

The output is an f-string which substitutes first the value of x, followed by the one-element tuple `(x,)`, then appends the character `)`. So we expect this function to return the input, followed by a tuple containing the input, then the `)` character.

Let's try it a couple of times:

```python
y = lambda  x:f"{x}{(x,)})"

print(y('banana'))
print(y(5))
print(y((1,3,5)))
```

**Output:**
```
banana('banana',))  
5(5,))  
(1, 3, 5)((1, 3, 5),))
```

So this function yields a string output consisting of the string representation of the three parts below, concatenated together:

1.  The input
2.  A tuple containing only the input
3.  A closing parenthesis character `)`

However something interesting happens if we feed this function an expression like `'chimp',`

Normally we expect Python to recognise this as a tuple and treat it the same way as the single-item tuple `('chimp',).` In that case we would expect the output `('chimp',)(('chimp',) ,))`

But test it, and you'll see a different behaviour:

```python
y = lambda  x:f"{x}{(x,)})"

print(y('chimp',))
```
**Output:**
```
chimp('chimp',))
```

What??? That looks nothing like what happened when we used the tuple `(1, 3, 5)` as an input.

Something curious is going on. To understand what, consider what happens if you try to evaluate `y('chimp','apple','grape')`. You'll get an error - the function y is expecting one positional argument, not three!

See, Python regards `` `y('chimp','apple','grape')` `` not as an instruction to take the tuple `('chimp','apple','grape')` and pass it into the function `y`, but rather as an instruction to take the strings `'chimp'`, `'apple'` and `'grape'` and pass them to the function as positional arguments.

Likewise, when we evaluate `` `y('chimp',)` `` , Python will see `'chimp',` not as a tuple argument, but as a tuple of positional arguments that happens to contain just one argument.

`y('chimp',) == y('chimp') == chimp('chimp',))`

This trick is crucial to this particular quine!

Reading the quine
-----------------

Let's take a look at the whole quine:

```python
print((lambda x:f"{x}{x,})")('print((lambda x:f"{x}{x,})")',))
```

So let's work through and see what this does. Ignoring the print statement for a moment:

```python
(lambda x:f"{x}{x,})")('print((lambda x:f"{x}{x,})")',)
```

So we take our beloved function from the previous section, and give it the input `'print((lambda x:f"{x}{x,})")',`

Per the `'chimp'`, example above, we know this output will be identical to:

```
(lambda x:f"{x}{x,})")('print((lambda x:f"{x}{x,})")')
```

Now we expect:

1.  The input == `print((lambda x:f"{x}{x,})")`
2.  A tuple containing only the input == (`'print((lambda x:f"{x}{x,})")'`,)
3.  A closing parenthesis == `)`

Concatenate the string representations of the above, and get:

```
print((lambda x:f"{x}{x,})")('print((lambda x:f"{x}{x,})")',))
```

This is the code of the quine itself, which will be wrapped in the print function we ignored earlier. Therefore, the quine will output its own code to the console. So it is a quine!

The "tricks" - parentheses and commas
-------------------------------------

This particular quine exploits two main quirks of Python.

Firstly, the fact that parentheses `()` are used in two different ways. They can be used to delimit a tuple `(a,b)` or to pass argument(s) to a function `func(a,b,c...)`. One could argue about how different the two uses are, since the arguments passed to a function do constitute a tuple...leaving that quibble aside, these can be thought of as distinct uses for parentheses.

The parentheses in this quine are, at various points, characters in a string, tuple delimiters, and delimiters of the argument(s) passed to a function.

The second quirk is that for any function `func` and argument `x`, we have the following: `func(x,) == func(x)`.

By exploiting these quirks, this quine manages to print itself. Fun!
  </div><a class="u-url" href="/blog/2021/09-02-Understanding-a-Python-38-Quine/post.txt" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Dave Bartram Blog</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Dave Bartram Blog</li><li><a class="u-email" href="mailto:david.bartram@gmail.com">david.bartram@gmail.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/davidbartram"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">davidbartram</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Lessons I&#39;m learning as a: Software platform engineer, Tabletop roleplayer, Lifelong lover of maths &amp; science</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
